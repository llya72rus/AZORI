$(document).ready(function() {

  /*
    Очень-очень плохой код
  */

  $('#card-1 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-1 .card__colors'
  });

  $('#card-1 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-1 .card__images',
    focusOnSelect: true,
  });

  $('#card-2 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-2 .card__colors'
  });

  $('#card-2 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-2 .card__images',
    focusOnSelect: true,
  });

  $('#card-3 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-3 .card__colors'
  });

  $('#card-3 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-3 .card__images',
    focusOnSelect: true,
  });

  $('#card-4 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-4 .card__colors'
  });

  $('#card-4 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-4 .card__images',
    focusOnSelect: true,
  });

  $('#card-5 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-5 .card__colors'
  });

  $('#card-5 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-5 .card__images',
    focusOnSelect: true,
  });

  $('#card-6 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-6 .card__colors'
  });

  $('#card-6 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-6 .card__images',
    focusOnSelect: true,
  });

  $('#card-7 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-7 .card__colors'
  });

  $('#card-7 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-7 .card__images',
    focusOnSelect: true,
  });

  $('#card-8 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-8 .card__colors'
  });

  $('#card-8 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-8 .card__images',
    focusOnSelect: true,
  });

  $('#card-9 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-9 .card__colors'
  });

  $('#card-9 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-9 .card__images',
    focusOnSelect: true,
  });

  $('#card-10 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-10 .card__colors'
  });

  $('#card-10 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-10 .card__images',
    focusOnSelect: true,
  });

  $('#card-11 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-11 .card__colors'
  });

  $('#card-11 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-11 .card__images',
    focusOnSelect: true,
  });

  $('#card-12 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-12 .card__colors'
  });

  $('#card-12 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-12 .card__images',
    focusOnSelect: true,
  });

  $('#card-13 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-13 .card__colors'
  });

  $('#card-13 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-13 .card__images',
    focusOnSelect: true,
  });

  $('#card-14 .card__images').slick({
    speed: 500,
    arrows: false,
    slidesToShow:  1,
    slidesToScroll: 1,
    asNavFor: '#card-14 .card__colors'
  });

  $('#card-14 .card__colors').slick({
    speed: 500,
    slidesToShow: 3,
    slidesToScroll: 1,
    infinite: false,
    draggable: false,
    asNavFor: '#card-14 .card__images',
    focusOnSelect: true,
  });

  /*
      Конец  очень-очень плохого кода
  */

  // Слайдеры

  $('.f-about__slick').slick({
    dots: false,
    arrows: true,
    infinite: true,
    speed: 300,
    slidesToShow: 4,
    slidesToScroll: 1,
    responsive: [
      {
        breakpoint: 1025,
        settings: {
          slidesToShow: 2,
          centerMode: true,
          centerPadding: '72px'
        }
      },

      {
        breakpoint: 768,
        settings: {
          slidesToShow: 2,
          centerMode: true,
          centerPadding: '10%',
          arrows: false,
          dots: true
        }
      },

      {
        breakpoint: 670,
        settings: {
          slidesToShow: 1,
          centerMode: true,
          centerPadding: '50px',
          arrows: false,
          dots: true
        }
      },

      {
        breakpoint: 375,
        settings: {
          slidesToShow: 1,
          centerMode: true,
          centerPadding: '25px',
          arrows: false,
          dots: true
        }
      }
    ]
  });

  $('.main-header__slick').slick({
    dots: true,
    arrows: true,
    infinite: true,
    speed: 600,
    centerMode: true,
    centerPadding: '21.2%',
    slidesToShow: 1,
    slidesToScroll: 1,
    nextArrow: '<button type="button" class="main-header__slick-next">Следующий слайд</button>',
    prevArrow: '<button type="button" class="main-header__slick-prev">Предыдущий слайд</button>',
    responsive: [
      {
        breakpoint: 1600,
        settings: {
          centerPadding: '15%'
        }
      },

    {
      breakpoint: 1300,
      settings: {
        centerPadding: '12%'
      }
    },

    {
      breakpoint: 1025,
      settings: {
        centerPadding: '9%'
      }
    },

    {
      breakpoint: 769,
      settings: {
        centerPadding: '11.5%'
      }
    },

    {
      breakpoint: 767,
      settings: {
        centerPadding: '0',
        centerMode: false
      }
    },
  ]
  });


  $('.news__list:not(.news__list--full)').slick({
    mobileFirst: true,
    arrows: false,
    dots: true,
    // fade: true,
    responsive: [

      {
        breakpoint: 670,
        settings: 'unslick'
      }
    ]
  });


  $('.catalog-top-slider').slick({
    speed: 500,
    useTransform: false,
    nextArrow: '<button type="button" class="catalog-top-slider__next">Следующий слайд</button>',
    prevArrow: '<button type="button" class="catalog-top-slider__prev">Предыдущий слайд</button>',
  });

  $('.collection__gallery').slick({
    speed: 500,
    slidesToShow:  1,
    slidesToScroll: 1,
    infinite: true,
    arrows: true,
    nextArrow: '<button type="button" class="top-gallery__next">Следующий слайд</button>',
    prevArrow: '<button type="button" class="top-gallery__prev">Предыдущий слайд</button>'
  });

  $('.single-new__top-gallery').slick({
    speed: 500,
    slidesToShow:  1,
    slidesToScroll: 1,
    infinite: false,
    arrows: true,
    asNavFor: '.top-gallery__thumbs',
    nextArrow: '<button type="button" class="top-gallery__next">Следующий слайд</button>',
    prevArrow: '<button type="button" class="top-gallery__prev">Предыдущий слайд</button>',
  });

  $('.top-gallery__thumbs').slick({
    speed: 500,
    slidesToShow:  4,
    slidesToScroll: 4,
    focusOnSelect: true,
    infinite: false,
    animate: false,
    arrows: false,
    asNavFor: '.single-new__top-gallery',
    dots: true,

    responsive: [

      {
        breakpoint: 1024,
        settings: {
          slidesToShow: 4,
        }
      },

      {
        breakpoint: 670,
        settings: {
          slidesToShow: 3,
        }
      }
    ]
  });

  $(".top-gallery__thumbs .slick-slide").click(function() {
    $(".top-gallery__thumbs .slick-slide").removeClass('top-gallery__thumb-active');
    $(this).addClass('top-gallery__thumb-active');
  });

  // Добавление инлайновых стилей для элементов верхней галлереи на странице отдельной новости

  // (function () {
  //   var slides = document.querySelector('.single-new__top-gallery .slick-track');
  //   var singleNewGallery = document.querySelector('.single-new__top-gallery');
  //   if (slides) {
  //     if (slides && slides.children.length > 5) {
  //       singleNewGallery.querySelector('.slick-dots').classList.add('slick-dots-flex-start');
  //     };

  //     var hasHeightGallery = slides.offsetHeight / 2;

  //     var arrows =  document.querySelectorAll('.single-new__top-gallery .slick-arrow')
  //     for (var i = 0; i < arrows.length; i++) {
  //       arrows[i].setAttribute("style", "top: " + hasHeightGallery + "px");
  //     }


  //   if (window.matchMedia("(max-width: 1024px)").matches) {
  //       if (slides.children.length  > 3) {
  //         singleNewGallery.querySelector('.slick-dots').classList.add('slick-dots-flex-start');
  //       };
  //   }

  //   window.addEventListener("resize", function() {
  //     if (window.matchMedia("(max-width: 1024px)").matches) {
  //       if (slides.children.length  > 3) {
  //         singleNewGallery.querySelector('.slick-dots').classList.add('slick-dots-flex-start');
  //       };
  //     }
  //   });
  // }





  // })();

  $('.projects-preview').slick({
    speed: 500,
    slidesToShow:  4,
    slidesToScroll: 4,
    infinite: false,
    arrows: true,
    nextArrow: '<button type="button" class="projects-preview__slide-next">Следующий слайд</button>',
    prevArrow: '<button type="button" class="projects-preview__slide-prev">Предыдущий слайд</button>',
    responsive: [

      {
        breakpoint: 1280,
        settings: {
          slidesToShow: 3,
          slidesToScroll: 3
        }
      },

      {
        breakpoint: 1024,
        settings: {
          slidesToShow: 2,
          slidesToScroll: 2,
          dots: true,
          arrows: false
        }
      },

      {
        breakpoint: 670,
        settings: {
          slidesToShow: 1,
          slidesToScroll: 1,
          arrows: false,
          dots: true,
        }
      }

    ]
  });

  $('.preview__slider').slick({
    speed: 500,
    slidesToShow:  3,
    slidesToScroll: 1,
    infinite: false,
    arrows: true,
    nextArrow: '<button type="button" class="orange-rounded-btn-next">Следующий слайд</button>',
    prevArrow: '<button type="button" class="orange-rounded-btn-prev">Предыдущий слайд</button>',
    responsive: [

      {
        breakpoint: 1400,
        settings: {
          slidesToShow: 2
        }
      },

      {
        breakpoint: 1366,
        settings: {
          variableWidth: false,
          slidesToShow: 2,
          arrows: false,
          dots: true
        }
      },

      {
        breakpoint: 670,
        settings: {
          variableWidth: false,
          slidesToShow: 1,
          arrows: false,
          dots: true,
        }
      }

    ]
  });

  $('.viewed__wrapper').slick({
    speed: 500,
    slidesToShow:  2,
    slidesToScroll: 1,
    infinite: true,
    arrows: true,
    nextArrow: '<button type="button" class="orange-rounded-btn-next">Следующий слайд</button>',
    prevArrow: '<button type="button" class="orange-rounded-btn-prev">Предыдущий слайд</button>',
    responsive: [

      {
        breakpoint: 1366,
        settings: {
          variableWidth: false,
          arrows: false,
          dots: true
        }
      },

      {
        breakpoint: 670,
        settings: {
          variableWidth: false,
          slidesToShow: 1,
          arrows: false,
          dots: true,
        }
      }
    ]
  });


  $('.collection__colors-list').slick({
    speed: 500,
    slidesToShow:  4,
    slidesToScroll: 1,
    infinite: false,
    animate: false,
    arrows: false,
    dots: true,

    responsive: [

      {
        breakpoint: 767,
        settings: {
          slidesToShow: 3,
          infinite: true
        }

      }
    ]
  });

  $(".collection__colors-list .slick-slide").click(function() {
    $(".collection__colors-list .slick-slide").removeClass('collection__slick-active');
    $(this).addClass('collection__slick-active');
  });

  $('.certificates__slider').slick({
    speed: 500,
    slidesToShow:  4,
    slidesToScroll: 4,
    infinite: false,
    arrows: true,
    nextArrow: '<button type="button" class="orange-rounded-btn-next">Следующий слайд</button>',
    prevArrow: '<button type="button" class="orange-rounded-btn-prev">Предыдущий слайд</button>',
    responsive: [

      {
        breakpoint: 1024,
        settings: {
          arrows: false,
          dots: true
        }
      },

      {
        breakpoint: 767,
        settings: {
          slidesToShow: 2,
          arrows: false,
          dots: true
        }
      }

    ]
  });

  $('.ab-charcs__slider').slick({
    speed: 500,
    slidesToShow:  2,
    slidesToScroll: 1,
    infinite: false,
    arrows: true,
    nextArrow: '<button type="button" class="orange-rounded-btn-next orange-rounded-btn-next--ab-charcs">Следующий слайд</button>',
    prevArrow: '<button type="button" class="orange-rounded-btn-prev orange-rounded-btn-prev--ab-charcs">Предыдущий слайд</button>',
    responsive: [

      {
        breakpoint: 1400,
        settings: {
          slidesToShow: 2
        }
      },

      {
        breakpoint: 1366,
        settings: {
          variableWidth: false,
          slidesToShow: 2,
          arrows: false,
          dots: true
        }
      },

      {
        breakpoint: 670,
        settings: {
          variableWidth: false,
          slidesToShow: 1,
          arrows: false,
          dots: true,
        }
      }

    ]
  });


   // Мобильное меню

  (function () {

    $('.main-header .menu-toggle').click(function() {
      $(this).toggleClass('open');
      $('.main-nav').toggleClass('main-nav--show');
      $('.mobile-header').toggleClass('mobile-header--menu-opened');

    });


    $('.page-nav .menu-toggle').click(function(e) {
      e.stopPropagation();
      $(this).toggleClass('open');
      $('.page-nav').toggleClass('page-nav--menu-opened');
      $('.page-nav__list').toggleClass('page-nav__list--show');
    });

    $(window).click(function(e) {
      var target = e.target
      if($('.page-nav__list').hasClass('page-nav__list--show') && target != $('.page-nav__link')) {
        $('.page-nav').removeClass('page-nav--menu-opened');
        $('.page-nav__list').removeClass('page-nav__list--show');
        $('.menu-toggle').removeClass('open');
      }
    });



  })();

  // $('.news__desc').readmore({
  //   speed: 75,
  //   collapsedHeight: 150,
  //   moreLink: '<a class="news__readmore" href="#">Читать полностью</a>',
  // });

$('.news__desc').each(function() {
    var ths = $(this);
   if(ths.height()>130){
       ths.addClass('news__desc--ellipsis');
   }
});
  // Аккордион

  (function () {

    var showFilter = document.querySelector(".catalog__collapse-filter");
    $(".catalog__collapse-filter").click(function() {
      $(this).toggleClass("catalog__collapse-filter--active");

      var panel = this.nextElementSibling;
      if (panel.style.display === "block") {
          panel.style.display = "none";
      } else {
          panel.style.display = "block";
      }
    });

    var acc = document.querySelectorAll(".acc-toggle");

    for (var i = 0; i < acc.length; i++) {
      acc[i].addEventListener("click", function() {
        this.classList.toggle("acc-toggle--active");
        var panel = this.nextElementSibling;
        if (panel.style.maxHeight){
          panel.style.maxHeight = null;
        } else {
          panel.style.maxHeight = panel.scrollHeight + "px";
        }
      });
    }
  })();

  // Замена текста кнопки скрыть/раскрыть фильтр при клике на нее

  $('.catalog__collapse-filter').click(function () {
    if ($(this).hasClass('catalog__collapse-filter--active')) {
      $(this).text('Скрыть фильтр')
    } else {
      $(this).text('Раскрыть фильтр');
    }
  });

  // Закрываем всплывающее окно на странице отдельной коллекции

  function openModal () {
    collModal.classList.add('modal--show');
  }

  function closeModal () {
    collModal.classList.remove('modal--show');
  }



  var collModal = document.querySelector('.modal');
  var closeCollModalBtn = document.querySelector('.coll-popup__close-btn');
  var collForm = $('.coll-popup');
  var collElems = document.querySelectorAll('.coll-elems__item');

  if (closeCollModalBtn && collModal) {
    closeCollModalBtn.addEventListener('click', function () {
      collModal.classList.remove('modal--show');
    });
  }

  // for (var i = 0; i < collElems.length; i++) {
  //   if (collElems && closeCollModalBtn) {
  //     collElems[i].addEventListener('click', function (evt) {
  //       evt.preventDefault();
  //       openModal();
  //       collForm.style.top = topScroll;
  //     });
  //   }
  // }

  window.addEventListener('keydown', function (evt) {
    if (evt.keyCode === 27 && collModal) {
      if (collModal.classList.contains('modal--show')) {
        closeModal();
      }
    }
  });

  window.addEventListener('click', function (evt) {
    if (evt.target === collModal && collModal) {
      closeModal();
    }
  });

  $('.search-input-wrap a').on('click', function(e) {
    e.preventDefault();
    var par = $(this).parents('.search-nav');
    var input = par.find('input[type="text"]');
    if (par.hasClass('focused') && input.val().length>0){
      input.parents('form').submit();
    } else {
      par.toggleClass('focused');
      input.focus();
    }
  });

var pageHeight = $(document).height();

$('.modal').css('height', pageHeight);



var topScroll;

$(document).scroll(function() {
  var topScroll = $(document).scrollTop();
});

$('.coll-elems__item').click(function () {
  $('.modal').addClass('modal--show');
  var topScroll = $(document).scrollTop() + ($(window).height() / 2) ;
  $('.coll-popup').css('top', topScroll);
});

var innerHeaderHeight = $('.page-header').height();
$('.inner-body').css('padding-top', innerHeaderHeight);

$(window).resize(function() {
  innerHeaderHeight = $('.page-header').height();
  $('.inner-body').css('padding-top', innerHeaderHeight);
});


$('.top-icons-panel__item--search a').click(function (evt) {
    evt.stopPropagation();
    $('.top-icons-panel__input-wrapper input').css('display', 'block');
    $( ".top-icons-panel__input-wrapper").animate({
      width: "+=300"
    },  500);
});


$('.top-icons-panel__search-btn').click(function () {

  $( ".top-icons-panel__input-wrapper").animate({
    width: "-=300"
  }, 500, function () {
    $('.top-icons-panel__input-wrapper input').css('display', 'none');
  }
);
});


$('.mobile-header__search').click(function (evt) {
  evt.stopPropagation();
  $('.mobile-search__form').css('display', 'block');
  $( ".mobile-search").animate({
    width: "+=37.4%"
  }, 500);
});


$('.mobile-search__btn').click(function () {
  $( ".mobile-search").animate({
    width: "-=37.4%"
  }, 500, function () {
    $('.mobile-search__form').css('display', 'none');
  }
);
});

// $(window).click(function () {
//   if (active) {
//     $(".mobile-search").hide();
//     active = false;
//   } else {
//     return;
//   }
// })


  // $('.coll-elems__item').click(function () {
  //   $('.modal').addClass('modal--show');
  // })

  // $('body').mouseup(function() {
  //   if ((!$(this.target).is('.coll-popup')) && (collModal.hasClass('modal--show'))) {
  //     $(collModal).removeClass('modal--show');
  //   }
  // });



  // Функционал кнопки "Наверх"

  if ($('.back-to-top').length) {
    var scrollTrigger = 800, // px
        backToTop = function () {
            var scrollTop = $(window).scrollTop();
            if (scrollTop > scrollTrigger) {
                $('.back-to-top').addClass('show');
            } else {
                $('.back-to-top').removeClass('show');
            }
        };
    backToTop();
    $(window).on('scroll', function () {
        backToTop();
    });
    $('.back-to-top').on('click', function (e) {
        e.preventDefault();
        $('html,body').animate({
            scrollTop: 0
        }, 700);
    });
}

// Белый непрозрачный фон шапки при скролле > 80px

$(window).scroll(function() {
  var top = $(document).scrollTop();
  if (top > 80) {
    $('.main-header__top-header').addClass('main-header__top-header--white-bg');
  } else {
    $('.main-header__top-header').removeClass('main-header__top-header--white-bg');
  }

});

});
